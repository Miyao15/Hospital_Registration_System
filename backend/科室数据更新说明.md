# 科室数据更新说明

## 问题

为了支持健康检查推荐项目（特别是"牙齿清洁"和"年度妇科检查"），需要在科室表中添加对应的科室。

## 解决方案

### 方案1：如果数据库已经初始化

如果您的数据库已经包含了初始数据（5个科室），请执行：

```sql
-- 执行文件：04_add_missing_departments.sql
```

这个脚本会：
- 添加口腔科（dpt-006）
- 添加妇科（dpt-007）
- 使用 `WHERE NOT EXISTS` 确保不会重复插入

### 方案2：如果重新初始化数据库

如果您要重新初始化数据库，`01_add_examination_items.sql` 已经更新，包含了7个科室：
- dpt-001: 心血管内科
- dpt-002: 骨科
- dpt-003: 皮肤科
- dpt-004: 儿科
- dpt-005: 眼科
- **dpt-006: 口腔科**（新增）
- **dpt-007: 妇科**（新增）

## 新增科室详情

### 口腔科 (dpt-006)
- **名称**：口腔科
- **类别**：其他
- **描述**：诊治口腔、牙齿、牙龈及相关疾病的专科
- **位置**：门诊大楼一层D区
- **电话**：010-12345676
- **排序**：6

### 妇科 (dpt-007)
- **名称**：妇科
- **类别**：其他
- **描述**：为女性提供妇科疾病诊断、治疗和预防保健服务
- **位置**：门诊大楼二层C区
- **电话**：010-12345677
- **排序**：7

## 执行步骤

### 步骤1：添加缺失的科室

在 Navicat 中执行：

```sql
-- 文件：04_add_missing_departments.sql
```

或者直接执行：

```sql
-- 添加口腔科
INSERT INTO departments (id, name, category, description, location, phone, sort_order, enabled) 
SELECT 'dpt-006', '口腔科', '其他', '诊治口腔、牙齿、牙龈及相关疾病的专科。', '门诊大楼一层D区', '010-12345676', 6, 1
WHERE NOT EXISTS (SELECT 1 FROM departments WHERE id = 'dpt-006' OR name = '口腔科');

-- 添加妇科
INSERT INTO departments (id, name, category, description, location, phone, sort_order, enabled) 
SELECT 'dpt-007', '妇科', '其他', '为女性提供妇科疾病诊断、治疗和预防保健服务。', '门诊大楼二层C区', '010-12345677', 7, 1
WHERE NOT EXISTS (SELECT 1 FROM departments WHERE id = 'dpt-007' OR name = '妇科');
```

### 步骤2：验证科室数据

```sql
-- 查看所有科室
SELECT * FROM departments ORDER BY sort_order;

-- 应该看到7个科室
SELECT COUNT(*) as total_departments FROM departments WHERE enabled = 1;
```

### 步骤3：更新检查项目关联关系

执行 `03_update_examination_items_data.sql`，该脚本已经更新，会自动关联：
- 牙齿清洁 → 口腔科 (dpt-006)
- 年度妇科检查 → 妇科 (dpt-007)

## 完整的执行顺序

1. **添加缺失的科室**
   ```sql
   -- 执行：04_add_missing_departments.sql
   ```

2. **创建关联表**（如果还没有）
   ```sql
   -- 执行：02_create_examination_item_departments.sql
   ```

3. **更新检查项目数据**
   ```sql
   -- 执行：03_update_examination_items_data.sql
   ```

4. **验证数据**
   ```sql
   -- 查看检查项目及其关联的科室
   SELECT 
       ei.id, 
       ei.name, 
       GROUP_CONCAT(d.name ORDER BY d.name) as departments
   FROM examination_items ei
   LEFT JOIN examination_item_departments eid ON ei.id = eid.examination_item_id
   LEFT JOIN departments d ON eid.department_id = d.id
   WHERE ei.enabled = 1
   GROUP BY ei.id, ei.name
   ORDER BY ei.id;
   ```

## 预期结果

执行后，每个健康检查推荐项目都应该关联到对应的科室：

| 检查项目 | 关联科室 |
|---------|---------|
| 年度体检 | 心血管内科、皮肤科 |
| 皮肤检查 | 皮肤科 |
| 牙齿清洁 | 口腔科 |
| 眼科检查 | 眼科 |
| 年度妇科检查 | 妇科 |

## 注意事项

1. **如果医院没有口腔科或妇科**：
   - 可以删除对应的检查项目
   - 或者将关联关系改为其他相关科室（如全科）

2. **科室信息可以自定义**：
   - 位置、电话等信息可以根据实际情况修改
   - 确保 `id` 与关联表中的 `department_id` 一致

3. **医生数据**：
   - 添加科室后，需要在 `doctors` 表中添加对应科室的医生
   - 否则搜索时可能没有医生显示

