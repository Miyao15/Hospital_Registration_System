# 更新检查项目数据说明

## 📋 当前情况

检查项目表中目前还是**具体检查项目**（如血常规、尿常规等），需要更新为**健康检查推荐项目**（如健康体检、皮肤检查等）。

## ✅ 已修改脚本

已更新 `03_update_examination_items_data.sql` 脚本，内容已调整为**符合中国医院实际情况**：

### 修改内容

1. **健康体检**：描述改为符合中国医院习惯的健康体检说明
2. **皮肤检查**：移除"美国癌症协会"等描述，改为适合中国实际情况的描述
3. **口腔检查**：改为"口腔检查"（而非"牙齿清洁"），符合中国医院科室命名
4. **眼科检查**：描述改为符合中国医院实际情况
5. **妇科检查**：描述改为符合中国医院实际情况

### 新的检查项目列表

| ID | 名称 | 描述 | 关联科室 |
|---|---|---|---|
| item-001 | 健康体检 | 定期健康体检有助于及早发现潜在疾病，建议每年进行一次全面体检 | 心血管内科、皮肤科 |
| item-002 | 皮肤检查 | 定期进行皮肤检查可早期发现皮肤病变 | 皮肤科 |
| item-003 | 口腔检查 | 定期口腔检查可预防龋齿、牙周病等口腔疾病 | 口腔科 |
| item-004 | 眼科检查 | 定期眼科检查可早期发现近视、远视、青光眼等眼部疾病 | 眼科 |
| item-005 | 妇科检查 | 定期妇科检查是女性健康管理的重要组成部分 | 妇科 |

## 🚀 执行步骤

### 步骤1：备份现有数据（重要！）

在 Navicat 中执行：

```sql
-- 备份检查项目表
CREATE TABLE examination_items_backup AS SELECT * FROM examination_items;

-- 备份关联表（如果存在）
CREATE TABLE examination_item_departments_backup AS SELECT * FROM examination_item_departments;

-- 检查是否有预约使用了检查项目
SELECT COUNT(*) as appointments_with_items 
FROM appointments 
WHERE medical_item_id IS NOT NULL;
```

### 步骤2：执行更新脚本

在 Navicat 中执行：

```sql
-- 执行文件：03_update_examination_items_data.sql
```

**或者手动执行以下 SQL：**

```sql
-- 1. 清空关联关系
DELETE FROM examination_item_departments WHERE 1=1;

-- 2. 删除旧的检查项目数据
DELETE FROM examination_items WHERE 1=1;

-- 3. 插入新的健康检查推荐项目
INSERT INTO examination_items (id, name, description, price, category, department_id, enabled, created_at) VALUES
('item-001', '健康体检', '定期健康体检有助于及早发现潜在疾病，建议每年进行一次全面体检，关注身体各项指标变化。', 0.00, '常规检查', NULL, 1, NOW()),
('item-002', '皮肤检查', '定期进行皮肤检查可早期发现皮肤病变，特别是有皮肤疾病家族史或经常暴露在阳光下的人群。', 0.00, '专科检查', NULL, 1, NOW()),
('item-003', '口腔检查', '定期口腔检查可预防龋齿、牙周病等口腔疾病，建议每半年到一年进行一次口腔检查和洁牙。', 0.00, '专科检查', NULL, 1, NOW()),
('item-004', '眼科检查', '定期眼科检查可早期发现近视、远视、青光眼、白内障等眼部疾病，建议每年进行一次视力检查。', 0.00, '专科检查', NULL, 1, NOW()),
('item-005', '妇科检查', '定期妇科检查是女性健康管理的重要组成部分，建议每年进行一次妇科常规检查，包括妇科内诊、宫颈检查等。', 0.00, '专科检查', NULL, 1, NOW());

-- 4. 建立关联关系
INSERT INTO examination_item_departments (id, examination_item_id, department_id, created_at) VALUES
(UUID(), 'item-001', 'dpt-001', NOW()), -- 健康体检 -> 心血管内科
(UUID(), 'item-001', 'dpt-003', NOW()), -- 健康体检 -> 皮肤科
(UUID(), 'item-002', 'dpt-003', NOW()), -- 皮肤检查 -> 皮肤科
(UUID(), 'item-003', 'dpt-006', NOW()), -- 口腔检查 -> 口腔科
(UUID(), 'item-004', 'dpt-005', NOW()), -- 眼科检查 -> 眼科
(UUID(), 'item-005', 'dpt-007', NOW()); -- 妇科检查 -> 妇科
```

### 步骤3：验证数据

执行以下查询验证：

```sql
-- 查看新的检查项目
SELECT 
    ei.id,
    ei.name as 检查项目,
    ei.description as 描述,
    ei.category as 类别,
    GROUP_CONCAT(d.name ORDER BY d.name) as 关联科室
FROM examination_items ei
LEFT JOIN examination_item_departments eid ON ei.id = eid.examination_item_id
LEFT JOIN departments d ON eid.department_id = d.id
WHERE ei.enabled = 1
GROUP BY ei.id, ei.name, ei.description, ei.category
ORDER BY ei.id;
```

**预期结果：**

| id | 检查项目 | 类别 | 关联科室 |
|---|---|---|---|
| item-001 | 健康体检 | 常规检查 | 皮肤科,心血管内科 |
| item-002 | 皮肤检查 | 专科检查 | 皮肤科 |
| item-003 | 口腔检查 | 专科检查 | 口腔科 |
| item-004 | 眼科检查 | 专科检查 | 眼科 |
| item-005 | 妇科检查 | 专科检查 | 妇科 |

## ⚠️ 注意事项

1. **预约数据**：如果已有预约关联了旧的检查项目（exam-001 等），执行删除后这些预约的 `medical_item_id` 会指向不存在的记录。建议先处理这些预约数据。

2. **科室关联**：确保以下科室存在：
   - dpt-001: 心血管内科
   - dpt-003: 皮肤科
   - dpt-005: 眼科
   - dpt-006: 口腔科（如果没有，先执行 `04_add_missing_departments.sql`）
   - dpt-007: 妇科（如果没有，先执行 `04_add_missing_departments.sql`）

3. **数据恢复**：如果需要恢复，可以从备份表恢复：
   ```sql
   DELETE FROM examination_items;
   INSERT INTO examination_items SELECT * FROM examination_items_backup;
   ```

## 📝 执行前后对比

### 执行前
- 具体检查项目：血常规、尿常规、肝功能检查等
- 用于具体的医疗检查项目

### 执行后
- 健康检查推荐项目：健康体检、皮肤检查、口腔检查等
- 用于筛选医生，通过关联的科室找到相关医生

## ✅ 执行完成检查清单

- [ ] 已备份现有数据
- [ ] 已执行更新脚本
- [ ] 检查项目表中有 5 个健康检查推荐项目
- [ ] 关联关系表中有 6 条关联记录
- [ ] 所有数据中文显示正常
- [ ] 前端可以正常显示和选择检查项目

执行完成后，重启后端服务，前端即可正常使用新的健康检查推荐项目功能！

