# 立即更新检查项目数据

## 问题

首页显示的检查项目还是旧的（血常规、尿常规等），而不是新的健康检查推荐项目（健康体检、皮肤检查等）。

## 原因

数据库中的数据还没有被更新，需要执行更新脚本。

## 解决步骤

### 步骤1：在 Navicat 中打开查询窗口

1. 连接到 `hospital_registration` 数据库
2. 点击"查询"按钮，新建查询

### 步骤2：备份现有数据（可选但建议）

```sql
-- 备份检查项目表
CREATE TABLE examination_items_backup AS SELECT * FROM examination_items;

-- 备份关联表（如果存在）
CREATE TABLE examination_item_departments_backup AS SELECT * FROM examination_item_departments;
```

### 步骤3：执行更新脚本

**直接复制以下 SQL 执行：**

```sql
-- =================================================================================================
-- 更新检查项目数据：从具体检查项目改为健康检查推荐项目
-- =================================================================================================

-- 步骤1：清空关联关系
DELETE FROM examination_item_departments WHERE 1=1;

-- 步骤2：删除旧的检查项目数据
DELETE FROM examination_items WHERE 1=1;

-- 步骤3：插入新的健康检查推荐项目（符合中国医院实际情况）
INSERT INTO examination_items (id, name, description, price, category, department_id, enabled, created_at) VALUES
('item-001', '健康体检', '定期健康体检有助于及早发现潜在疾病，建议每年进行一次全面体检，关注身体各项指标变化。', 0.00, '常规检查', NULL, 1, NOW()),
('item-002', '皮肤检查', '定期进行皮肤检查可早期发现皮肤病变，特别是有皮肤疾病家族史或经常暴露在阳光下的人群。', 0.00, '专科检查', NULL, 1, NOW()),
('item-003', '口腔检查', '定期口腔检查可预防龋齿、牙周病等口腔疾病，建议每半年到一年进行一次口腔检查和洁牙。', 0.00, '专科检查', NULL, 1, NOW()),
('item-004', '眼科检查', '定期眼科检查可早期发现近视、远视、青光眼、白内障等眼部疾病，建议每年进行一次视力检查。', 0.00, '专科检查', NULL, 1, NOW()),
('item-005', '妇科检查', '定期妇科检查是女性健康管理的重要组成部分，建议每年进行一次妇科常规检查，包括妇科内诊、宫颈检查等。', 0.00, '专科检查', NULL, 1, NOW());

-- 步骤4：建立检查项目与科室的关联关系
INSERT INTO examination_item_departments (id, examination_item_id, department_id, created_at) VALUES
(UUID(), 'item-001', 'dpt-001', NOW()), -- 健康体检 -> 心血管内科
(UUID(), 'item-001', 'dpt-003', NOW()), -- 健康体检 -> 皮肤科
(UUID(), 'item-002', 'dpt-003', NOW()), -- 皮肤检查 -> 皮肤科
(UUID(), 'item-003', 'dpt-006', NOW()), -- 口腔检查 -> 口腔科
(UUID(), 'item-004', 'dpt-005', NOW()), -- 眼科检查 -> 眼科
(UUID(), 'item-005', 'dpt-007', NOW()); -- 妇科检查 -> 妇科
```

### 步骤4：验证数据

执行以下查询验证：

```sql
-- 查看新的检查项目
SELECT 
    ei.id,
    ei.name as 检查项目,
    ei.description as 描述,
    ei.category as 类别,
    ei.price as 价格,
    GROUP_CONCAT(d.name ORDER BY d.name) as 关联科室
FROM examination_items ei
LEFT JOIN examination_item_departments eid ON ei.id = eid.examination_item_id
LEFT JOIN departments d ON eid.department_id = d.id
WHERE ei.enabled = 1
GROUP BY ei.id, ei.name, ei.description, ei.category, ei.price
ORDER BY ei.id;
```

**预期结果：**

| id | 检查项目 | 类别 | 价格 | 关联科室 |
|---|---|---|---|---|
| item-001 | 健康体检 | 常规检查 | 0.00 | 皮肤科,心血管内科 |
| item-002 | 皮肤检查 | 专科检查 | 0.00 | 皮肤科 |
| item-003 | 口腔检查 | 专科检查 | 0.00 | 口腔科 |
| item-004 | 眼科检查 | 专科检查 | 0.00 | 眼科 |
| item-005 | 妇科检查 | 专科检查 | 0.00 | 妇科 |

### 步骤5：刷新前端页面

1. 清除浏览器缓存（按 Ctrl+F5 强制刷新）
2. 或者重启前端服务
3. 重新访问首页，应该看到新的健康检查推荐项目

## 注意事项

1. **确保科室存在**：更新脚本中使用了以下科室ID：
   - dpt-001: 心血管内科
   - dpt-003: 皮肤科
   - dpt-005: 眼科
   - dpt-006: 口腔科（如果没有，先执行 `04_add_missing_departments.sql`）
   - dpt-007: 妇科（如果没有，先执行 `04_add_missing_departments.sql`）

2. **预约数据**：如果已有预约关联了旧的检查项目（exam-001 等），这些预约的 `medical_item_id` 会指向不存在的记录。需要先处理这些数据。

3. **如果更新失败**：可以从备份恢复：
   ```sql
   DELETE FROM examination_items;
   INSERT INTO examination_items SELECT * FROM examination_items_backup;
   ```

## 快速检查

执行后，运行以下查询确认数据已更新：

```sql
-- 检查项目数量（应该是5个）
SELECT COUNT(*) FROM examination_items WHERE enabled = 1;
-- 预期：5

-- 检查是否有旧的检查项目（exam-001 等）
SELECT COUNT(*) FROM examination_items WHERE id LIKE 'exam-%';
-- 预期：0

-- 检查是否有新的检查项目（item-001 等）
SELECT COUNT(*) FROM examination_items WHERE id LIKE 'item-%';
-- 预期：5
```

执行完成后，刷新前端页面即可看到新的数据！

