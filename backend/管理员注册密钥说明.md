# ç®¡ç†å‘˜æ³¨å†Œå¯†é’¥è¯´æ˜

## ğŸ”‘ å¯†é’¥é…ç½®

### åœ¨ `application.yml` ä¸­ï¼ˆç¬¬45è¡Œï¼‰

```yaml
app:
  security:
    admin-registration-key: "YOUR_SECRET_ADMIN_KEY"
```

**å½“å‰é…ç½®çš„å¯†é’¥æ˜¯**: `YOUR_SECRET_ADMIN_KEY`

---

## ğŸ“‹ ç®¡ç†å‘˜æ³¨å†Œæ—¶éœ€è¦æä¾›çš„å­—æ®µ

### APIæ¥å£
```
POST /api/auth/register/admin
```

### è¯·æ±‚ä½“ (JSON)
```json
{
  "phone": "13800000001",
  "password": "password123",
  "name": "ç‹ç®¡ç†",
  "employeeId": "A0001",
  "adminRegistrationKey": "YOUR_SECRET_ADMIN_KEY"
}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| phone | String | âœ… | æ‰‹æœºå·ï¼ˆ11ä½ï¼Œ1å¼€å¤´ï¼‰ |
| password | String | âœ… | å¯†ç ï¼ˆè‡³å°‘8ä½ï¼‰ |
| name | String | âœ… | å§“å |
| employeeId | String | âœ… | å·¥å· |
| adminRegistrationKey | String | âœ… | **ç®¡ç†å‘˜æ³¨å†Œå¯†é’¥ï¼ˆå¿…é¡»ä¸é…ç½®æ–‡ä»¶ä¸­çš„ä¸€è‡´ï¼‰** |

---

## âœ… æ­£ç¡®çš„æ³¨å†Œç¤ºä¾‹

### ä½¿ç”¨ Postman æˆ–å…¶ä»–APIå·¥å…·

```json
POST http://localhost:8080/api/auth/register/admin
Content-Type: application/json

{
  "phone": "13900000010",
  "password": "admin12345",
  "name": "æç®¡ç†å‘˜",
  "employeeId": "A0002",
  "adminRegistrationKey": "YOUR_SECRET_ADMIN_KEY"
}
```

### ä½¿ç”¨ curl å‘½ä»¤

```bash
curl -X POST http://localhost:8080/api/auth/register/admin \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "13900000010",
    "password": "admin12345",
    "name": "æç®¡ç†å‘˜",
    "employeeId": "A0002",
    "adminRegistrationKey": "YOUR_SECRET_ADMIN_KEY"
  }'
```

---

## âŒ å¸¸è§é”™è¯¯

### 1. å¯†é’¥é”™è¯¯
```json
{
  "adminRegistrationKey": "wrong_key"  // âŒ é”™è¯¯
}
```
**é”™è¯¯ä¿¡æ¯**: "ç®¡ç†å‘˜æ³¨å†Œå¯†é’¥æ— æ•ˆ"

### 2. å¯†é’¥ç¼ºå¤±
```json
{
  "phone": "13900000010",
  "password": "admin12345",
  "name": "æç®¡ç†å‘˜",
  "employeeId": "A0002"
  // âŒ ç¼ºå°‘ adminRegistrationKey å­—æ®µ
}
```
**é”™è¯¯ä¿¡æ¯**: "ç®¡ç†å‘˜æ³¨å†Œå¯†é’¥ä¸èƒ½ä¸ºç©º"

### 3. å¯†é’¥æ ¼å¼é”™è¯¯
```json
{
  "adminRegistrationKey": YOUR_SECRET_ADMIN_KEY  // âŒ ç¼ºå°‘å¼•å·
}
```
åº”è¯¥æ˜¯å­—ç¬¦ä¸²ï¼Œéœ€è¦åŠ å¼•å·ï¼š
```json
{
  "adminRegistrationKey": "YOUR_SECRET_ADMIN_KEY"  // âœ… æ­£ç¡®
}
```

---

## ğŸ”§ ä¿®æ”¹å¯†é’¥ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ æƒ³ä¿®æ”¹ç®¡ç†å‘˜æ³¨å†Œå¯†é’¥ï¼Œç¼–è¾‘ `application.yml`ï¼š

```yaml
app:
  security:
    admin-registration-key: "my-custom-secret-key-2024"
```

**æ³¨æ„**ï¼šä¿®æ”¹åéœ€è¦é‡å¯åç«¯æœåŠ¡ï¼

---

## ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå¯†é’¥ï¼Ÿ

ç®¡ç†å‘˜è´¦æˆ·æƒé™å¾ˆé«˜ï¼Œä¸èƒ½è®©ä»»ä½•äººéšæ„æ³¨å†Œã€‚è¿™ä¸ªå¯†é’¥æ˜¯ä¸€ä¸ªå®‰å…¨æœºåˆ¶ï¼š

1. **é˜²æ­¢æœªæˆæƒæ³¨å†Œ**ï¼šåªæœ‰çŸ¥é“å¯†é’¥çš„äººæ‰èƒ½æ³¨å†Œç®¡ç†å‘˜
2. **å†…éƒ¨æ§åˆ¶**ï¼šé€šå¸¸åªæœ‰ç³»ç»Ÿç»´æŠ¤äººå‘˜çŸ¥é“è¿™ä¸ªå¯†é’¥
3. **ç”Ÿäº§ç¯å¢ƒå¿…é¡»**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªå¯†é’¥åº”è¯¥è®¾ç½®å¾—æ›´å¤æ‚ä¸”ä¿å¯†

---

## ğŸ¯ å¿«é€Ÿæµ‹è¯•

### æ­¥éª¤1ï¼šç¡®è®¤å¯†é’¥

æ‰“å¼€ `application.yml`ï¼Œæ‰¾åˆ°ç¬¬45è¡Œï¼Œç¡®è®¤å¯†é’¥æ˜¯ï¼š
```
YOUR_SECRET_ADMIN_KEY
```

### æ­¥éª¤2ï¼šä½¿ç”¨Postmanæµ‹è¯•

1. æ‰“å¼€ Postman
2. æ–°å»ºè¯·æ±‚ï¼Œé€‰æ‹© POST
3. è¾“å…¥URLï¼š`http://localhost:8080/api/auth/register/admin`
4. é€‰æ‹© Body â†’ raw â†’ JSON
5. è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š

```json
{
  "phone": "13900000010",
  "password": "admin12345",
  "name": "æµ‹è¯•ç®¡ç†å‘˜",
  "employeeId": "A0010",
  "adminRegistrationKey": "YOUR_SECRET_ADMIN_KEY"
}
```

6. ç‚¹å‡» Send

### æ­¥éª¤3ï¼šæ£€æŸ¥å“åº”

**æˆåŠŸå“åº”**ï¼ˆçŠ¶æ€ç  201ï¼‰ï¼š
```json
{
  "success": true,
  "data": {
    "userId": "xxx-xxx-xxx",
    "message": "ç®¡ç†å‘˜æ³¨å†ŒæˆåŠŸ"
  }
}
```

**å¤±è´¥å“åº”**ï¼ˆå¦‚æœå¯†é’¥é”™è¯¯ï¼‰ï¼š
```json
{
  "success": false,
  "message": "ç®¡ç†å‘˜æ³¨å†Œå¯†é’¥æ— æ•ˆ"
}
```

---

## ğŸ” ä»£ç éªŒè¯é€»è¾‘

åœ¨ `AuthService.java` ç¬¬62è¡Œï¼š

```java
if (!Objects.equals(adminRegistrationKey, request.getAdminRegistrationKey())) {
    throw BusinessException.invalidAdminKey();
}
```

è¿™è¡Œä»£ç æ£€æŸ¥ï¼š
- `adminRegistrationKey`ï¼šé…ç½®æ–‡ä»¶ä¸­çš„å¯†é’¥ï¼ˆ`YOUR_SECRET_ADMIN_KEY`ï¼‰
- `request.getAdminRegistrationKey()`ï¼šæ³¨å†Œè¯·æ±‚ä¸­æä¾›çš„å¯†é’¥

**ä¸¤è€…å¿…é¡»å®Œå…¨ä¸€è‡´**ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ï¼

---

## ğŸ“ æ€»ç»“

**ç®¡ç†å‘˜æ³¨å†Œå¯†é’¥**: `YOUR_SECRET_ADMIN_KEY`

**ä½¿ç”¨æ–¹æ³•**: åœ¨æ³¨å†Œç®¡ç†å‘˜æ—¶ï¼Œè¯·æ±‚ä½“ä¸­å¿…é¡»åŒ…å«ï¼š
```json
{
  "adminRegistrationKey": "YOUR_SECRET_ADMIN_KEY"
}
```

**æ³¨æ„äº‹é¡¹**:
1. âœ… å¿…é¡»æ˜¯å­—ç¬¦ä¸²æ ¼å¼ï¼ˆåŠ å¼•å·ï¼‰
2. âœ… åŒºåˆ†å¤§å°å†™
3. âœ… å¿…é¡»ä¸ application.yml ä¸­çš„é…ç½®ä¸€è‡´
4. âœ… ä¸èƒ½ä¸ºç©º

---

## ğŸš¨ é‡è¦æç¤º

**åœ¨ç”Ÿäº§ç¯å¢ƒä¸­**ï¼Œåº”è¯¥ï¼š
1. ä¿®æ”¹è¿™ä¸ªé»˜è®¤å¯†é’¥ä¸ºå¤æ‚çš„éšæœºå­—ç¬¦ä¸²
2. ä¸è¦å°†å¯†é’¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
3. ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥é…ç½®å¯†é’¥
4. å®šæœŸæ›´æ¢å¯†é’¥

**ç¤ºä¾‹ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰**ï¼š
```yaml
app:
  security:
    admin-registration-key: ${ADMIN_REGISTRATION_KEY:YOUR_SECRET_ADMIN_KEY}
```

è¿™æ ·å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ `ADMIN_REGISTRATION_KEY` æ¥è®¾ç½®å¯†é’¥ï¼Œæ›´å®‰å…¨ï¼

